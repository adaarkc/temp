install.packages("devtools")
install.packages("worldfootballR")
install.packages("tidyverse")
install.packages("ggplot2)")
install.packages("ggsoccer")

devtools::install_github("JaseZiv/worldfootballR")

library(worldfootballR)
library(dplyr)
library(ggplot2)
library(ggsoccer)

## Leicester vs Man Utd, Sep-01-22, Match 18251
## Total Match Shots and Data 

match_shots_raw <- understat_match_shots(match_url = "https://understat.com/match/18251")

View(match_shots_raw)

## Only Keep: Result, X, Y, Player, xG and Home_Away

match_shots_clean <- match_shots_raw[,c("result","X", "Y", "player", "xG", "home_away")]

View(match_shots_clean) 

## Filter only to see Man Utd shots

man_utd_shots <- filter(match_shots_clean, home_away=="a")

View(man_utd_shots)

## Renaming values in Result column 

man_utd_shots <- man_utd_shots %>% 
  mutate(result=recode(result, BlockedShot='Missed', MissedShots='Missed', SavedShot='Missed'))

View(man_utd_shots)

## Multiplying X & Y by 100 to make it show in Pitch 

man_utd_shots$X <- man_utd_shots$X*100
man_utd_shots$Y <- man_utd_shots$Y*100

View(man_utd_shots) ##done upt to here

## Changing column "result" no "Result"

colnames(man_utd_shots)[1] <- "Result"

View(man_utd_shots)

## Creating Man Utd Shots Visual and
## Setting up color for each Result Manually

cols <- c("Goal"="#F5163F", "Missed"="#596BBA")

## Making plot  

ggplot(man_utd_shots) +
  annotate_pitch(colour = "#454545",
                 fill = "#191919") +
  geom_point(aes(x = X, y = Y, colour = Result, fill = Result, size = xG, shape = Result)) +
  coord_flip(xlim=c(70,105),
             ylim=c(100,0)) +
  theme_pitch() +
  scale_colour_manual(values = cols, aesthetics = c("colour", "fill"))+
  
  scale_size_continuous(range = c(2,6))+ # adding a minimum to point size 
  
  guides(size=guide_legend(override.aes=list(colour="#DCDCDC")), colour=guide_legend(override.aes=list(size=4)))+ # change xG color legend
  
  theme(panel.background = element_rect(fill = "#191919"),
        plot.background = element_rect(fill = "#191919"), # everything same background color
        legend.background = element_rect(fill = "#191919"), # including legend box
        legend.key = element_rect(fill = "#191919", color = NA), #including legend key box
        legend.text = element_text(colour="white"), #legend text
        legend.title = element_text(colour="white")) # legend title

